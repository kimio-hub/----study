# 第2周：条件概率与乘法公式（整理）

## 课程目标
- 理解条件概率的定义与直观含义。  
- 熟练运用乘法公式、链式法则、全概率公式与贝叶斯公式。  
- 掌握独立性与条件独立的判断及常见误区。  
- 能处理离散与连续情形下的条件概率/条件密度问题，并能用练习题巩固。

---

## 1. 条件概率的定义与直观解释
- 定义：对事件 \(A,B\) 且 \(P(B)>0\)，条件概率定义为
  \[
  P(A\mid B)=\frac{P(A\cap B)}{P(B)}.
  \]
- 直观：把样本空间“缩小”到 \(B\) 后，考察在该条件下 \(A\) 发生的相对可能性。  
- 频率解释：在大量重复试验中，仅统计那些出现 \(B\) 的试验样本，出现 \(A\) 的频率近似 \(P(A\mid B)\)。

---

## 2. 乘法公式与链式法则
- 两事件的乘法公式：
  \[
  P(A\cap B)=P(B)\,P(A\mid B)=P(A)\,P(B\mid A).
  \]
- 多事件链式法则（对事件序列 \(A_1,\dots,A_n\)，且每个中间分母非零）：
  \[
  P\Big(\bigcap_{i=1}^n A_i\Big)=P(A_1)\,P(A_2\mid A_1)\,P(A_3\mid A_1\cap A_2)\cdots P(A_n\mid A_1\cap\cdots\cap A_{n-1}).
  \]

---

## 3. 全概率公式与贝叶斯公式
- 全概率公式：若 \(\{B_i\}_{i=1}^n\) 是划分（互不相交且并为全集），且 \(P(B_i)>0\)，则对任意事件 \(A\)：
  \[
  P(A)=\sum_{i=1}^n P(B_i)\,P(A\mid B_i).
  \]
- 贝叶斯公式（后验概率）：
  \[
  P(B_j\mid A)=\frac{P(B_j)\,P(A\mid B_j)}{\sum_{i=1}^n P(B_i)\,P(A\mid B_i)}.
  \]

---

## 4. 条件概率的基本性质
- 非负性：若 \(P(B)>0\)，则 \(0\le P(A\mid B)\le 1\)。  
- 规范性：\(P(B\mid B)=1\)。  
- 加法性（在条件下）：若 \(A_1,A_2\) 在条件 \(B\) 下互斥，则
  \[
  P(A_1\cup A_2\mid B)=P(A_1\mid B)+P(A_2\mid B).
  \]
- 单调性：若 \(A_1\subseteq A_2\)，则 \(P(A_1\mid B)\le P(A_2\mid B)\)。

---

## 5. 独立性与条件独立
- 无条件独立：\(A\) 与 \(B\) 独立当且仅当
  \[
  P(A\cap B)=P(A)P(B),
  \]
  等价于（若 \(P(B)>0\)）\(P(A\mid B)=P(A)\)。
- 条件独立：在给定 \(C\) 的条件下，若
  \[
  P(A\cap B\mid C)=P(A\mid C)P(B\mid C)
  \]
  则称 \(A\) 与 \(B\) 在条件 \(C\) 下条件独立。
- 注意：互斥 ≠ 独立（非零概率下互斥必不独立）；条件独立与无条件独立互不蕴含。

---

## 6. 连续情形：条件密度
- 若联合密度 \(f_{X,Y}(x,y)\) 存在且边缘 \(f_Y(y)>0\)，定义条件密度
  \[
  f_{X\mid Y}(x\mid y)=\frac{f_{X,Y}(x,y)}{f_Y(y)},\qquad f_Y(y)=\int f_{X,Y}(x,y)\,dx.
  \]
- 乘法关系：\(f_{X,Y}(x,y)=f_Y(y)f_{X\mid Y}(x\mid y)=f_X(x)f_{Y\mid X}(y\mid x)\)。  
- 连续版贝叶斯（密度形式）：
  \[
  f_{Y\mid X}(y\mid x)=\frac{f_{X\mid Y}(x\mid y)f_Y(y)}{\int f_{X\mid Y}(x\mid y')f_Y(y')\,dy'}.
  \]

---

## 7. 证明要点（简要）
- 乘法公式：由定义 \(P(A\mid B)=P(A\cap B)/P(B)\) 直接得到。  
- 链式法则：对 \(A_1\cap A_2\cap A_3\) 先写成 \(P(A_1)\,P(A_2\mid A_1)\,P(A_3\mid A_1\cap A_2)\)，归纳可得一般形式。  
- 全概率：把 \(A\) 表示为 \(\bigcup_i (A\cap B_i)\)（互不相交），对两边取概率并代入乘法公式。

---

## 8. 常见误区与注意事项
- 混淆 \(P(A\mid B)\) 与 \(P(B\mid A)\)。两者通常不相等。  
- 忽视先验（基率谬误）：例如医学检验中忽视低患病率会导致对阳性结果的错误判断。  
- 分母为零：若 \(P(B)=0\)，条件概率需用极限或测度论工具处理，不可直接套用公式。  
- 条件独立与独立的区分：条件独立不一定导致无条件独立。

---

## 9. 例题与练习（含答案要点）

例1（硬币）：抛两次公正硬币，记事件 \(A\) = “第一次为正面”，\(B\) = “至少出现一次正面”。求 \(P(A\mid B)\)。  
- 解：样本空间 \{HH,HT,TH,TT\}，\(B=\{HH,HT,TH\}\)，在 \(B\) 中 \(A=\{HH,HT\}\)，所以 \(P(A\mid B)=2/3\)。

例2（医学检验，基率谬误）：已知 \(P(D)=0.01\)，灵敏度 \(P(+\mid D)=0.99\)，假阳性率 \(P(+\mid D^c)=0.05\)。求 \(P(D\mid +)\)。  
- 解：分子 \(=0.01\cdot0.99\)。分母 \(=0.01\cdot0.99+0.99\cdot0.05\)。计算得约 \(0.1667\)。

例3（盒子问题，全概率+贝叶斯）：盒子 A 有 2 红 1 白，盒子 B 有 1 红 2 白，随机选盒再抽一球，抽到红球则求是来自 A 的概率。  
- 解：\(P(R)=\tfrac12\cdot\tfrac23+\tfrac12\cdot\tfrac13=\tfrac12\)。所以 \(P(A\mid R)=\dfrac{\tfrac12\cdot\tfrac23}{\tfrac12}=\tfrac23\)。

例4（链式法则验证）：三次独立抛硬币，三次都为正面的概率为 \(1\cdot\tfrac12\cdot\tfrac12=\tfrac18\)。

练习1：给出三个事件的乘法展开并说明每一项条件的含义。  
练习2：设诊断测试灵敏度为 0.95，特异度为 0.90，患病率为 0.02，求阳性后的患病概率并讨论结果（数值代入并解释基率影响）。

---

## 10. 数值模拟（蒙特卡洛）示例（可选）
- 思路：用大量重复模拟计算经验频率 f_n(A∣B) 来观察其收敛到理论值 \(P(A\mid B)\)。  
- 可实现脚本（Python）：重复进行试验、统计满足 B 的样本数及同时满足 A∩B 的样本数，计算比值并绘图观察收敛趋势。

---

## 11. 参考与延伸
- 教材：概率论与数理统计常用教材（Casella & Berger，Ross 等）以及课程课件。  
- 进阶：学习测度论下的条件概率、条件期望（Rohlin 条件期望）、与统计学中的贝叶斯推断。

---

## 12. 小结
- 条件概率是概率论核心概念之一，理解“在已知某事发生的条件下重新定义样本空间”的直观非常重要。  
- 全概率与贝叶斯为分解与更新概率的基本工具；链式法则便于处理多步事件的联合概率。  
- 多做带有先验/似然的实例，避免基率谬误，熟练辨别独立性与条件独立性。
