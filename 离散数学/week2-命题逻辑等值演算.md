# 第2周：命题逻辑的等值演算

## 课程目标
- 理解“等值式”的含义与常用等值变换规则。  
- 掌握将任意命题公式化为析取范式（DNF）、合取范式（CNF）以及主析取范式（PDNF）与主合取范式（PCNF）的步骤。  
- 能用等值变换化简公式并判断公式等价性。

## 关键词
- 逻辑等值（A ≡ B）
- 等值式（变换规则）
- 消去蕴含、德摩根律、分配律
- DNF / CNF / PDNF / PCNF
- 归约与化简

---

## 1. 等值的基本概念
若对于所有赋值 v，v(A)=v(B)，则称公式 A 与 B 语义等值，记 A ≡ B。等值演算即应用一组等值律把公式变形为等价形式以便化简或规范化。等值演算不仅用于推导也用于把公式转换为适合算法（如 SAT 求解器）的形式。

---

## 2. 常见等值式（汇总与陈列）
- 双重否定：¬(¬A) ≡ A  
- 蕴含消去：A → B ≡ ¬A ∨ B  
- 等值消去：A ↔ B ≡ (A → B) ∧ (B → A) ≡ (¬A ∨ B) ∧ (¬B ∨ A)  
- 德摩根律：¬(A ∧ B) ≡ ¬A ∨ ¬B； ¬(A ∨ B) ≡ ¬A ∧ ¬B  
- 分配律：A ∨ (B ∧ C) ≡ (A ∨ B) ∧ (A ∨ C)； A ∧ (B ∨ C) ≡ (A ∧ B) ∨ (A ∧ C)  
- 吸收律：A ∨ (A ∧ B) ≡ A； A ∧ (A ∨ B) ≡ A  
- 幂等律：A ∨ A ≡ A；A ∧ A ≡ A  
- 蕴含重写（便于下推否定）：A → B ≡ ¬A ∨ B

提示：考试与上机时按顺序使用规则（消蕴含 → 下推否定 → 分配 → 化简）更稳妥。

---

## 3. 规范化的系统步骤（实践步骤）
从任意公式到 CNF/DNF 的常用流程（详尽）：
1. 用等值式消去蕴含（→）和等值（↔）。  
2. 消除双重否定（¬¬A ≡ A）。  
3. 使用德摩根律把否定“下推”至原子命题（得到否定范式 NNF）。  
4. 若需要 CNF：反复应用分配律把 ∨ 分配到 ∧ 上（将析取的项转为子句集合）。  
   若需要 DNF：把 ∧ 分配到 ∨ 上。  
5. 最后使用吸收律、幂等律、去重复字面简化子句或项。  
注：步骤中若遇到规模爆炸，可考虑 Tseitin 变换（引入新变元保持可满足性但不保持严格等值）。

---

## 4. 详细示例（逐步展开）

示例 A：将 H = (p → (q ∨ r)) → s 化为 CNF（逐步）
1. 消去蕴含：H ≡ ¬(p → (q ∨ r)) ∨ s ≡ ¬(¬p ∨ (q ∨ r)) ∨ s  
2. 合并：¬(¬p ∨ q ∨ r) ∨ s  
3. 德摩根下推： (p ∧ ¬q ∧ ¬r) ∨ s  
4. 分配到 CNF：等价于 (p ∨ s) ∧ (¬q ∨ s) ∧ (¬r ∨ s)  
（可检查每一步的真值不变）

示例 B：将 F = (p ∧ (q ∨ r)) 转为 DNF
1. 分配：F ≡ (p ∧ q) ∨ (p ∧ r) — 已为 DNF

示例 C（真值表→PDNF）: B = (p ↔ q)
真值表：
p q | p↔q
T T | T  -> 合取项 p ∧ q
T F | F
F T | F
F F | T  -> 合取项 ¬p ∧ ¬q
PDNF = (p ∧ q) ∨ (¬p ∧ ¬q)

---

## 5. Tseitin 变换（用于避免范式爆炸）
目的：将任意公式在多项式大小内转为 CNF 的可满足性等价（SAT 可直接使用），通过引入辅助变元 t_i 表示子公式。
- 例子：对 A = p ∨ (q ∧ r)，引入 t1 表示 q ∧ r，则约束：
  - t1 ↔ (q ∧ r) 转换为子句集合：
    (¬t1 ∨ q), (¬t1 ∨ r), (¬q ∨ ¬r ∨ t1)
  - 原公式变为 p ∨ t1，进一步转为 CNF: (p ∨ t1)
结果子句集合与原公式关于可满足性等价，规模线性增长。

注意：Tseitin 保证可满足性等价但不语义等值（不能直接恢复原公式的真假表而不带新变元）。

---

## 6. 空间与复杂度提示
- 把任意公式转为 PDNF/PCNF 可能导致指数级增长（2^n），不适用于变量多的情况。  
- 将公式直接转换为 CNF 可能通过分配律导致项数爆炸，Tseitin 变换是实务中常用的折衷方案（用于 SAT 求解器）。  
- 练习时关注“何时直接用真值表”、“何时用等值变换”以节约时间。

---

## 7. 常用化简技巧（考试/笔试速记）
- 先消去 →、↔；再下推 ¬；最后分配并即刻应用吸收律去除冗余。  
- 检查是否存在子句/项包含相反字面（例如 p ∨ ¬p），可直接判断为恒真/冗余。  
- 对称子公式可通过命名（替换为新变元）来降低手算复杂度（类似 Tseitin 的手工技巧）。

---

## 8. 练习（含要点答案）

练习1：将 H = (p → (q ∨ r)) → s 化为 CNF。  
答案要点：参考示例 A 得 (p ∨ s) ∧ (¬q ∨ s) ∧ (¬r ∨ s)。

练习2：A = (p ∨ (q ∧ r)) 化为 CNF。  
答案：A ≡ (p ∨ q) ∧ (p ∨ r)。

练习3：B = (p ↔ q) 的 PDNF。  
答案： (p ∧ q) ∨ (¬p ∧ ¬q)。

练习4（进阶）：对公式 X = (p ∨ q) ∧ (¬p ∨ r) 求一个等价的 DNF。  
解要点：分配并化简得： (p ∧ r) ∨ (q ∧ ¬p) ∨ (q ∧ r)；可进一步用吸收律简化（视具体步骤）。

练习5：对 A = (p ∨ (q ∧ r)) 用 Tseitin 变换写出子句集。  
答案要点：引入 t = q∧r，加入 (¬t ∨ q), (¬t ∨ r), (¬q ∨ ¬r ∨ t) 与 (p ∨ t)。

---

## 9. 参考与延伸阅读
- 经典教材：Epp、Rosen（离散数学）对应“命题逻辑”章节。  
- SAT 与 Tseitin：可查阅相关讲义或《Boolean Satisfiability》概览。  
- 建议练习：选取 3~5 个中等复杂公式，分别用真值表法和等值变换法化为 PDNF/CNF，比较步骤与复杂度。

---

## 小结
- 等值演算是逻辑化简与范式化的重要工具；掌握标准步骤并熟练应用等值律能高效完成手算或为算法预处理（如 SAT）做准备。  
- 实务中遇到规模问题时，采用 Tseitin 变换与 SAT 求解器是更可行的路径。